{"ast":null,"code":"var _jsxFileName = \"D:\\\\reactjs\\\\feedback-app-ts\\\\src\\\\components\\\\context\\\\FeedbackContext.tsx\",\n    _s = $RefreshSig$();\n\nimport { createContext, useState, useEffect } from 'react';\nimport { listToHashMap } from '../../utils';\nimport { v4 as uuidv4 } from 'uuid';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const FeedbackContext = /*#__PURE__*/createContext({});\nexport const FeedbackProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [isLoading, setIsLoading] = useState(true);\n  const [feedback, setFeedback] = useState(null);\n  const [feedbackEdit, setFeedbackEdit] = useState({\n    item: null,\n    edit: false\n  });\n  useEffect(async () => {// fetchFeedback();\n  }, []);\n\n  const fetchFeedback = async () => {\n    await reloadData();\n  };\n\n  const reloadData = () => {\n    return new Promise(async resolve => {\n      setIsLoading(true);\n      await fetch(`/feedback?_sort=id&_order=desc`).then(async response => {\n        const data = await response.json();\n        console.log(\"data realoaded successfuly!\");\n        setFeedback(listToHashMap(data, item => item.id));\n      }).catch(e => {\n        console.error(`reload error from: ${e}`);\n      }).finally(() => {\n        setIsLoading(false);\n      });\n    });\n  };\n\n  const deleteFeedback = async id => {\n    if (window.confirm(`are you sure you want to delete the item :  ${JSON.stringify(feedback === null || feedback === void 0 ? void 0 : feedback.get(id))} ?`)) {\n      const deleteFeedbackCall = await fetch(`/feedback/${id}`, {\n        method: 'DELETE'\n      });\n\n      if (deleteFeedbackCall.ok === true) {\n        try {\n          const responseCall = await deleteFeedbackCall.json();\n          console.log('delete response: ' + responseCall); // load new\n\n          await reloadData();\n        } catch (error) {\n          console.error(`error after delete: ${error}`);\n        }\n      } else {\n        console.warn(`delete status ${deleteFeedbackCall.status}`);\n      }\n    }\n  };\n\n  const addFeedback = async newFeedback => {\n    newFeedback.setId(uuidv4());\n    await fetch('/feedback', {\n      method: 'POST',\n      headers: {\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify(newFeedback)\n    }).then(async response => {\n      await reloadData();\n      const data = await response.json();\n      console.log(`addfeedback response: ${data}`);\n      await reloadData();\n    }).catch(e => console.error(e));\n  };\n\n  const editFeedback = item => {\n    if (!item || !item.item) {\n      return;\n    }\n\n    setFeedbackEdit({\n      item: item.item,\n      edit: true\n    });\n  };\n\n  const updateFeedback = async item => {\n    if (!item || !item.item) {\n      return;\n    } // const fb = mapDeepCopy(feedback);\n    // fb?.set(item.item.id, item.item);\n\n\n    await fetch(`/feedback/${item.item.id}`, {\n      method: 'PUT',\n      headers: {\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify(item.item)\n    }).then(async response => {\n      const data = await response.json();\n      console.log(`edit feedback response: ${data}`);\n      await reloadData();\n    }).catch(e => console.error(e)); // setFeedback(fb);\n  };\n\n  return /*#__PURE__*/_jsxDEV(FeedbackContext.Provider, {\n    value: {\n      feedbacks: feedback,\n      deleteFeedback: deleteFeedback,\n      addFeedback: addFeedback,\n      editFeedback: editFeedback,\n      feedbackEdit: feedbackEdit,\n      updateFeedback,\n      isLoading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 119,\n    columnNumber: 12\n  }, this);\n};\n\n_s(FeedbackProvider, \"26JXjyCNGGqEBOsEvOCcuFBqS3Q=\");\n\n_c = FeedbackProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"FeedbackProvider\");","map":{"version":3,"names":["createContext","useState","useEffect","listToHashMap","v4","uuidv4","FeedbackContext","FeedbackProvider","children","isLoading","setIsLoading","feedback","setFeedback","feedbackEdit","setFeedbackEdit","item","edit","fetchFeedback","reloadData","Promise","resolve","fetch","then","response","data","json","console","log","id","catch","e","error","finally","deleteFeedback","window","confirm","JSON","stringify","get","deleteFeedbackCall","method","ok","responseCall","warn","status","addFeedback","newFeedback","setId","headers","body","editFeedback","updateFeedback","feedbacks"],"sources":["D:/reactjs/feedback-app-ts/src/components/context/FeedbackContext.tsx"],"sourcesContent":["import { createContext, ReactNode, useState, useEffect } from 'react';\r\nimport { listToHashMap, mapDeepCopy, OrNull } from '../../utils';\r\nimport { Feedback, FeedbackInterface } from '../FeedbackForm';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { FeedbackItemEditInterface } from '../FeedbackItem';\r\n\r\n\r\nexport interface FeedbackProviderModelInterface  {\r\n    children ? : ReactNode,\r\n    feedbacks?: OrNull<Map<string, FeedbackInterface>>,\r\n    deleteFeedback ? : (id : string) => void,\r\n    addFeedback  ? : (newFeedback: Feedback) => void,\r\n    editFeedback ? : (item: OrNull<FeedbackItemEditInterface>) => void,\r\n    feedbackEdit ? : FeedbackItemEditInterface,\r\n    updateFeedback ? : (item: OrNull<FeedbackItemEditInterface>) => void,\r\n    isLoading ?: boolean,\r\n}\r\nexport const FeedbackContext = createContext<FeedbackProviderModelInterface>({  });\r\nexport const FeedbackProvider = ({children,} : FeedbackProviderModelInterface) =>{\r\n    const [isLoading, setIsLoading] = useState<boolean>(true);\r\n    const [feedback, setFeedback] = useState<OrNull<Map<string, FeedbackInterface>>>(null);\r\n    const [feedbackEdit, setFeedbackEdit] = useState<FeedbackItemEditInterface>({ item:null, edit: false });\r\n\r\n    useEffect(async () => {\r\n        // fetchFeedback();\r\n    }, []);\r\n    const fetchFeedback = async () => {\r\n        await reloadData();\r\n    }\r\n\r\n    const reloadData =  () : Promise<any> => {\r\n        return new Promise(async resolve => {\r\n            setIsLoading(true);\r\n            await fetch(`/feedback?_sort=id&_order=desc`)\r\n            .then(async response => {\r\n                const data: FeedbackInterface[] = await response.json();\r\n                console.log(\"data realoaded successfuly!\");\r\n                setFeedback(listToHashMap(data, item => item.id));\r\n                \r\n            }).catch(e => {\r\n                console.error(`reload error from: ${e}`);\r\n            }).finally (() => {\r\n                setIsLoading(false);\r\n            })\r\n        });\r\n    }\r\n\r\n    const deleteFeedback = async  (id: string)  => {\r\n        if (window.confirm(`are you sure you want to delete the item :  ${JSON.stringify(feedback?.get(id))} ?`)) {\r\n            \r\n            const deleteFeedbackCall = await fetch(`/feedback/${id}`, {\r\n                method: 'DELETE'\r\n            });\r\n            if (deleteFeedbackCall.ok === true) {\r\n                try {\r\n                    const responseCall = await deleteFeedbackCall.json();\r\n                    console.log('delete response: ' + responseCall);\r\n                    // load new\r\n                    await reloadData();\r\n                } catch (error) {\r\n                    console.error(`error after delete: ${error}`);\r\n                }\r\n            } else {\r\n                console.warn(`delete status ${deleteFeedbackCall.status}`);\r\n            }\r\n        }\r\n\r\n    }\r\n    const addFeedback = async (newFeedback: Feedback)  => {\r\n        newFeedback.setId(uuidv4());\r\n       await fetch('/feedback', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-type' : 'application/json'\r\n            }, \r\n            body: JSON.stringify(newFeedback)\r\n        }\r\n        ).then(async response =>{\r\n            await reloadData();\r\n            const data = await response.json();\r\n            console.log(`addfeedback response: ${data}`)\r\n            await reloadData();\r\n        }).catch(e => console.error(e)\r\n        );\r\n\r\n    }\r\n\r\n    const editFeedback = (item : OrNull<FeedbackItemEditInterface>)  => {\r\n        if (!item || !item.item){\r\n            return;\r\n        }\r\n        setFeedbackEdit({item : item.item , edit: true});\r\n    }\r\n\r\n    const updateFeedback = async (item: OrNull<FeedbackItemEditInterface>)  => {\r\n        if (!item || !item.item ) {\r\n            return;\r\n        }\r\n        // const fb = mapDeepCopy(feedback);\r\n        // fb?.set(item.item.id, item.item);\r\n\r\n        await fetch(`/feedback/${item.item.id}`, {\r\n            method: 'PUT',\r\n            headers: {\r\n                'Content-type': 'application/json'\r\n            },\r\n            body: JSON.stringify(item.item)\r\n        }\r\n        ).then(async response => {\r\n            const data = await response.json();\r\n            console.log(`edit feedback response: ${data}`)\r\n            await reloadData();\r\n        }).catch(e => console.error(e)\r\n        );\r\n       // setFeedback(fb);\r\n    }\r\n\r\n\r\n    return <FeedbackContext.Provider value={{\r\n        feedbacks: feedback,\r\n        deleteFeedback: deleteFeedback,\r\n        addFeedback: addFeedback,\r\n        editFeedback: editFeedback,\r\n        feedbackEdit: feedbackEdit,\r\n        updateFeedback,\r\n        isLoading,\r\n    }}>\r\n        {children}\r\n    </FeedbackContext.Provider>\r\n}"],"mappings":";;;AAAA,SAASA,aAAT,EAAmCC,QAAnC,EAA6CC,SAA7C,QAA8D,OAA9D;AACA,SAASC,aAAT,QAAmD,aAAnD;AAEA,SAASC,EAAE,IAAIC,MAAf,QAA6B,MAA7B;;AAcA,OAAO,MAAMC,eAAe,gBAAGN,aAAa,CAAiC,EAAjC,CAArC;AACP,OAAO,MAAMO,gBAAgB,GAAG,QAAiD;EAAA;;EAAA,IAAhD;IAACC;EAAD,CAAgD;EAC7E,MAAM,CAACC,SAAD,EAAYC,YAAZ,IAA4BT,QAAQ,CAAU,IAAV,CAA1C;EACA,MAAM,CAACU,QAAD,EAAWC,WAAX,IAA0BX,QAAQ,CAAyC,IAAzC,CAAxC;EACA,MAAM,CAACY,YAAD,EAAeC,eAAf,IAAkCb,QAAQ,CAA4B;IAAEc,IAAI,EAAC,IAAP;IAAaC,IAAI,EAAE;EAAnB,CAA5B,CAAhD;EAEAd,SAAS,CAAC,YAAY,CAClB;EACH,CAFQ,EAEN,EAFM,CAAT;;EAGA,MAAMe,aAAa,GAAG,YAAY;IAC9B,MAAMC,UAAU,EAAhB;EACH,CAFD;;EAIA,MAAMA,UAAU,GAAI,MAAqB;IACrC,OAAO,IAAIC,OAAJ,CAAY,MAAMC,OAAN,IAAiB;MAChCV,YAAY,CAAC,IAAD,CAAZ;MACA,MAAMW,KAAK,CAAE,gCAAF,CAAL,CACLC,IADK,CACA,MAAMC,QAAN,IAAkB;QACpB,MAAMC,IAAyB,GAAG,MAAMD,QAAQ,CAACE,IAAT,EAAxC;QACAC,OAAO,CAACC,GAAR,CAAY,6BAAZ;QACAf,WAAW,CAACT,aAAa,CAACqB,IAAD,EAAOT,IAAI,IAAIA,IAAI,CAACa,EAApB,CAAd,CAAX;MAEH,CANK,EAMHC,KANG,CAMGC,CAAC,IAAI;QACVJ,OAAO,CAACK,KAAR,CAAe,sBAAqBD,CAAE,EAAtC;MACH,CARK,EAQHE,OARG,CAQM,MAAM;QACdtB,YAAY,CAAC,KAAD,CAAZ;MACH,CAVK,CAAN;IAWH,CAbM,CAAP;EAcH,CAfD;;EAiBA,MAAMuB,cAAc,GAAG,MAAQL,EAAR,IAAwB;IAC3C,IAAIM,MAAM,CAACC,OAAP,CAAgB,+CAA8CC,IAAI,CAACC,SAAL,CAAe1B,QAAf,aAAeA,QAAf,uBAAeA,QAAQ,CAAE2B,GAAV,CAAcV,EAAd,CAAf,CAAkC,IAAhG,CAAJ,EAA0G;MAEtG,MAAMW,kBAAkB,GAAG,MAAMlB,KAAK,CAAE,aAAYO,EAAG,EAAjB,EAAoB;QACtDY,MAAM,EAAE;MAD8C,CAApB,CAAtC;;MAGA,IAAID,kBAAkB,CAACE,EAAnB,KAA0B,IAA9B,EAAoC;QAChC,IAAI;UACA,MAAMC,YAAY,GAAG,MAAMH,kBAAkB,CAACd,IAAnB,EAA3B;UACAC,OAAO,CAACC,GAAR,CAAY,sBAAsBe,YAAlC,EAFA,CAGA;;UACA,MAAMxB,UAAU,EAAhB;QACH,CALD,CAKE,OAAOa,KAAP,EAAc;UACZL,OAAO,CAACK,KAAR,CAAe,uBAAsBA,KAAM,EAA3C;QACH;MACJ,CATD,MASO;QACHL,OAAO,CAACiB,IAAR,CAAc,iBAAgBJ,kBAAkB,CAACK,MAAO,EAAxD;MACH;IACJ;EAEJ,CApBD;;EAqBA,MAAMC,WAAW,GAAG,MAAOC,WAAP,IAAkC;IAClDA,WAAW,CAACC,KAAZ,CAAkB1C,MAAM,EAAxB;IACD,MAAMgB,KAAK,CAAC,WAAD,EAAc;MACpBmB,MAAM,EAAE,MADY;MAEpBQ,OAAO,EAAE;QACL,gBAAiB;MADZ,CAFW;MAKpBC,IAAI,EAAEb,IAAI,CAACC,SAAL,CAAeS,WAAf;IALc,CAAd,CAAL,CAOHxB,IAPG,CAOE,MAAMC,QAAN,IAAiB;MACpB,MAAML,UAAU,EAAhB;MACA,MAAMM,IAAI,GAAG,MAAMD,QAAQ,CAACE,IAAT,EAAnB;MACAC,OAAO,CAACC,GAAR,CAAa,yBAAwBH,IAAK,EAA1C;MACA,MAAMN,UAAU,EAAhB;IACH,CAZI,EAYFW,KAZE,CAYIC,CAAC,IAAIJ,OAAO,CAACK,KAAR,CAAcD,CAAd,CAZT,CAAN;EAeF,CAjBD;;EAmBA,MAAMoB,YAAY,GAAInC,IAAD,IAA+C;IAChE,IAAI,CAACA,IAAD,IAAS,CAACA,IAAI,CAACA,IAAnB,EAAwB;MACpB;IACH;;IACDD,eAAe,CAAC;MAACC,IAAI,EAAGA,IAAI,CAACA,IAAb;MAAoBC,IAAI,EAAE;IAA1B,CAAD,CAAf;EACH,CALD;;EAOA,MAAMmC,cAAc,GAAG,MAAOpC,IAAP,IAAoD;IACvE,IAAI,CAACA,IAAD,IAAS,CAACA,IAAI,CAACA,IAAnB,EAA0B;MACtB;IACH,CAHsE,CAIvE;IACA;;;IAEA,MAAMM,KAAK,CAAE,aAAYN,IAAI,CAACA,IAAL,CAAUa,EAAG,EAA3B,EAA8B;MACrCY,MAAM,EAAE,KAD6B;MAErCQ,OAAO,EAAE;QACL,gBAAgB;MADX,CAF4B;MAKrCC,IAAI,EAAEb,IAAI,CAACC,SAAL,CAAetB,IAAI,CAACA,IAApB;IAL+B,CAA9B,CAAL,CAOJO,IAPI,CAOC,MAAMC,QAAN,IAAkB;MACrB,MAAMC,IAAI,GAAG,MAAMD,QAAQ,CAACE,IAAT,EAAnB;MACAC,OAAO,CAACC,GAAR,CAAa,2BAA0BH,IAAK,EAA5C;MACA,MAAMN,UAAU,EAAhB;IACH,CAXK,EAWHW,KAXG,CAWGC,CAAC,IAAIJ,OAAO,CAACK,KAAR,CAAcD,CAAd,CAXR,CAAN,CAPuE,CAoBxE;EACF,CArBD;;EAwBA,oBAAO,QAAC,eAAD,CAAiB,QAAjB;IAA0B,KAAK,EAAE;MACpCsB,SAAS,EAAEzC,QADyB;MAEpCsB,cAAc,EAAEA,cAFoB;MAGpCY,WAAW,EAAEA,WAHuB;MAIpCK,YAAY,EAAEA,YAJsB;MAKpCrC,YAAY,EAAEA,YALsB;MAMpCsC,cANoC;MAOpC1C;IAPoC,CAAjC;IAAA,UASFD;EATE;IAAA;IAAA;IAAA;EAAA,QAAP;AAWH,CA/GM;;GAAMD,gB;;KAAAA,gB"},"metadata":{},"sourceType":"module"}